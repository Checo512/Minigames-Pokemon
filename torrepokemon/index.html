<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROGRAMA TORRE POKEMON</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png">
</head>
<body>

    <!-- PANTALLA DE SELECCIÓN DE ROL -->
    <div id="login-screen">
        <h1 style="color: #ffcc00; text-shadow: 4px 4px #3b4cca; margin-bottom: 40px; text-align: center; line-height: 1.5;">TORRE POKEMON<br>MINIJUEGO DE ADIVINAR</h1>
        <button onclick="iniciarApp('espectador')">ESPECTADOR / JUGADOR</button>
        <button onclick="iniciarApp('moderador')">MODERADOR</button>
    </div>

    <!-- TABLERO PRINCIPAL (Lo que ven todos) -->
    <div id="main-board" class="hidden">
        
        <!-- JUGADOR 1 -->
        <div class="player-column">
            <!-- ESPACIO CAMARA J1 -->
            <div class="camera-box" id="cam-p1">
                <span>CÁMARA J1</span>
            </div>

            <h2 id="title-p1" class="blurred">ATRIBUTO 1</h2> 
            <div class="grid-container" id="grid-p1">
                <!-- Aquí aparecerán los sprites -->
            </div>
        </div>

        <!-- SEPARADOR CENTRAL -->
        <div class="separator"></div>

        <!-- JUGADOR 2 -->
        <div class="player-column">
            <!-- ESPACIO CAMARA J2 -->
            <div class="camera-box" id="cam-p2">
                <span>CÁMARA J2</span>
            </div>

            <h2 id="title-p2" class="blurred">ATRIBUTO 2</h2> 
            <div class="grid-container" id="grid-p2">
                <!-- Aquí aparecerán los sprites -->
            </div>
        </div>
    </div>

    <!-- PANEL DE CONTROL (Solo Moderador) -->
    <div id="mod-panel" class="hidden">
        
        <!-- COLUMNA 1: Títulos Secretos -->
        <div class="mod-column">
            <label style="color: #ffcc00;">TITULOS SECRETOS</label>
            
            <div style="display:flex; align-items:center; width: 100%;">
                <input type="text" id="input-title-p1" placeholder="Atributo J1">
                <input type="checkbox" id="check-p1" title="Revelar">
            </div>

            <div style="display:flex; align-items:center; width: 100%;">
                <input type="text" id="input-title-p2" placeholder="Atributo J2">
                <input type="checkbox" id="check-p2" title="Revelar">
            </div>

            <button class="btn-success" id="btn-update-titles">ACTUALIZAR TITULOS</button>
        </div>

        <div class="mod-separator"></div>

        <!-- COLUMNA 2: Buscador y Opciones -->
        <div class="mod-column">
            <label style="color: #ffcc00;">BUSCAR POKÉMON</label>
            
            <!-- Fila superior: Input + Botón Shiny -->
            <div style="display: flex; width: 100%; gap: 8px; align-items: center;">
                <input type="text" id="poke-search" list="lista-pokemon" autocomplete="off" placeholder="Nombre (Inglés)..." style="flex: 1;">
                <datalist id="lista-pokemon"></datalist>

                <!-- Checkbox Shiny compacto -->
                <div title="Marcar como Shiny" style="display: flex; align-items: center; justify-content: center; background: #333; border: 2px solid #555; border-radius: 4px; padding: 0 8px; height: 36px;">
                    <input type="checkbox" id="poke-shiny" style="transform: scale(1.3); cursor: pointer;">
                    <label for="poke-shiny" style="cursor: pointer; margin-left: 5px; font-size: 14px;">✨</label>
                </div>
            </div>
            
            <!-- Selector de Expresión abajo -->
            <label style="margin-top: 10px; font-size: 10px;">Expresión:</label>
            <select id="poke-emotion" style="width: 100%; margin-top: 5px;">
                <option value="Normal">Normal</option>
                <option value="Happy">Feliz</option>
                <option value="Angry">Enojado</option>
                <option value="Sad">Triste</option>
                <option value="Worried">Preocupado</option>
                <option value="Pain">Dolor</option>
                <option value="Determined">Determinado</option>
                <option value="Surprised">Sorprendido</option>
                <option value="Dizzy">Mareado</option>
            </select>
        </div>

        <div class="mod-separator"></div>

        <!-- COLUMNA 3: Acciones de Envío -->
        <div class="mod-column">
            <label style="color: #ffcc00;">ENVIAR A</label>
            <div style="display: flex; gap: 10px; width: 100%;">
                <button onclick="verificarYPreguntar(1)">JUGADOR 1</button>
                <button onclick="verificarYPreguntar(2)">JUGADOR 2</button>
            </div>
            <button class="btn-danger" onclick="reiniciarTablero()" style="margin-top: auto;">⚠ REINICIAR</button>
        </div>
    </div>

    <!-- VENTANA MODAL DE CONFIRMACIÓN (ENVÍO) -->
    <div id="modal-confirm" class="modal-overlay hidden">
        <div class="modal-box">
            <h3 style="color: #ffcc00;">CONFIRMAR ENVIO</h3>
            <p>Vas a enviar a: <br><span id="modal-poke-name" style="color: #3b4cca; font-weight: bold; font-size: 1.2em;">---</span></p>
            <p>¿Es Correcto o Incorrecto?</p>
            
            <div class="modal-buttons">
                <!-- Botón Verde -->
                <button onclick="enviarDefinitivo('color')" class="btn-correct">
                    ✔ CORRECTO<br><small>(A Color)</small>
                </button>
                
                <!-- Botón Gris -->
                <button onclick="enviarDefinitivo('gray')" class="btn-incorrect">
                    ✘ INCORRECTO<br><small>(Blanco y Negro)</small>
                </button>
            </div>
            
            <button onclick="cerrarModal()" style="margin-top: 15px; background: #555;">CANCELAR</button>
        </div>
    </div>

    <!-- VENTANA MODAL DE BORRADO (NUEVA) -->
    <div id="modal-delete" class="modal-overlay hidden">
        <div class="modal-box delete-box">
            <h3 style="color: #ff4444;">⚠ ELIMINAR</h3>
            <p>¿Seguro que quieres borrar este Pokémon?</p>
            <p style="font-size: 0.8em; color: #aaa;">Esta acción no se puede deshacer.</p>
            
            <div class="modal-buttons">
                <button onclick="confirmarBorrado()" class="btn-danger">SÍ, BORRAR</button>
                <button onclick="cerrarModalBorrado()" style="background: #555; color: white;">CANCELAR</button>
            </div>
        </div>
    </div>

    <!-- SONIDOS -->
    <audio id="audio-correct" src="correcto.mp3"></audio>
    <audio id="audio-incorrect" src="incorrecto.mp3"></audio>

    <!-- SCRIPTS -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="db.js"></script>
    <script src="script.js"></script>
</body>
</html>
